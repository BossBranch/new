# ProxyPass с Hit Detector (Клиентский Античит)

## Описание

Модифицированная версия ProxyPass с встроенным детектором ударов. Отслеживает когда другие игроки бьют вас и показывает расстояние в чате Minecraft.

## Возможности

- ✅ Отслеживание позиций всех игроков на сервере
- ✅ Детект ударов с определением атакующего
- ✅ Расчет расстояния между вами и атакующим
- ✅ Вывод информации в чат Minecraft (не в консоль!)
- ✅ Поддержка Minecraft Bedrock 1.21.111 (протокол v844)

## Как это работает

1. **Отслеживание игроков**: Прокси сохраняет позиции всех игроков вокруг вас
2. **Детект анимации**: Когда игрок делает удар (SWING_ARM), прокси запоминает его
3. **Детект урона**: Когда вы получаете урон (HURT event), прокси связывает это с последним ударом
4. **Вывод информации**: В чат отправляется сообщение:
   ```
   [HIT] PlayerName hit you from 3.45 blocks
   ```

## Конфигурация

Файл `config.yml` настроен для подключения к **Craft.PE:19132**:

```yaml
proxy:
  host: 0.0.0.0    # Прокси слушает на всех интерфейсах
  port: 19132      # Порт прокси (стандартный Minecraft порт)

destination:
  host: Craft.PE   # Целевой сервер
  port: 19132      # Порт сервера
```

## Использование

### 1. Сборка проекта

```bash
cd ProxyPass-master/ProxyPass-master
./gradlew shadowJar
```

Результат: `build/libs/ProxyPass.jar`

### 2. Запуск прокси

```bash
java -jar ProxyPass.jar
```

### 3. Подключение клиента

**Вариант А: Подключение к локальному прокси**
- IP: `127.0.0.1` (если на том же компьютере)
- Порт: `19132`

**Вариант Б: Подключение через сеть**
- IP: IP адрес компьютера с прокси
- Порт: `19132`

### 4. Пример работы

Когда вас бьют, в чате появится:
```
[HIT] Cheater123 hit you from 6.78 blocks
```

Если расстояние больше 4-5 блоков - возможно читер!

## Технические детали

### Обработанные пакеты

- `AddPlayerPacket` - добавление игроков в трекинг
- `MovePlayerPacket` - обновление позиций игроков
- `AnimatePacket` - детект анимации удара (SWING_ARM)
- `EntityEventPacket` - детект получения урона (HURT)
- `StartGamePacket` - получение runtime ID клиента

### Структура кода

```
HitDetector.java - основная логика детектора
  ├─ addPlayer() - добавить игрока в отслеживание
  ├─ updatePlayerPosition() - обновить позицию игрока
  ├─ onHitReceived() - обработка удара
  └─ sendChatMessage() - отправка сообщения в чат

DownstreamPacketHandler.java - обработка пакетов от сервера
  ├─ handle(AddPlayerPacket) - новый игрок
  ├─ handle(MovePlayerPacket) - движение игрока
  ├─ handle(AnimatePacket) - анимация удара
  ├─ handle(EntityEventPacket) - событие урона
  └─ handle(StartGamePacket) - начало игры

ProxyPlayerSession.java - сессия игрока
  └─ hitDetector - экземпляр HitDetector
```

### Алгоритм детекции

```
1. Игрок делает удар -> AnimatePacket (SWING_ARM)
   ↓ Сохраняем: lastSwingPlayerId, lastSwingTime

2. Клиент получает урон -> EntityEventPacket (HURT)
   ↓ Проверяем: прошло ли < 500ms с последнего удара?

3. Если да -> Это тот игрок который ударил
   ↓ Берем позиции: clientPosition, attackerPosition

4. Вычисляем расстояние: √((x₁-x₂)² + (y₁-y₂)² + (z₁-z₂)²)
   ↓

5. Отправляем TextPacket в чат клиента
```

## Ограничения

- Работает только в режиме "offline-mode" на сервере
- Может быть задержка до 500ms между ударом и сообщением
- Если несколько игроков бьют одновременно, покажет последнего
- Не работает для урона от мобов/окружения

## Возможные улучшения

- [ ] Добавить настройку максимального расстояния для алерта
- [ ] Логирование подозрительных ударов в файл
- [ ] Поддержка множественных одновременных атак
- [ ] Детект критических ударов
- [ ] Статистика по каждому игроку

## Отладка

Логи находятся в консоли и файлах:
- `sessions/` - логи сессий игроков
- `data/` - дампы пакетов

Для включения debug логов:
```java
log.debug("Player {} swung arm", packet.getRuntimeEntityId());
```

## Безопасность

⚠️ **Внимание**: Это инструмент для тестирования и защиты от читеров. Не используйте для:
- Нарушения правил серверов
- DDoS атак
- Читерства

## Автор

Основа: CloudburstMC ProxyPass
Модификация: Hit Detector для клиентского античита
Версия: 1.0 (Minecraft Bedrock 1.21.111)
